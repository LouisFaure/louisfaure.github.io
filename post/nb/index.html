<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=generator content="Source Themes Academic 4.5.0"><link rel=stylesheet href=https://louis.faure.dev/css/shield.css><meta name=author content="Louis Faure"><meta name=description content="The negative binomial (NB) distribution is the canonical statistical model for single-cell RNA-seq (scRNA-seq) gene expression integer counts. It’s favored over the Poisson distribution because real scRNA-seq data are overdispersed—their variance greatly exceeds their mean–due to both biological and technical factors (cell heterogeneity, bursty transcription, varied sequencing depth, dropouts, etc.).
The Poisson’s simple assumption (variance equals mean) fails in this context. In contrast, the NB augments the Poisson distribution with a dispersion parameter ($\theta$), so its variance is $\sigma^2 = \mu + \mu^2 / \theta$ (for mean $\mu$)."><script id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js></script><script>MathJax={tex:{displayMath:[["\\[","\\]"],["$$","$$"]],inlineMath:[["$","$"]]}}</script><link rel=alternate hreflang=en-us href=https://louis.faure.dev/post/nb/><meta name=theme-color content="#0A1922"><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/academicons/1.8.6/css/academicons.min.css integrity="sha256-uFVgMKfistnJAfoCUQigIl+JfUaP47GrRKjf6CTPVmw=" crossorigin=anonymous><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css integrity="sha512-Kc323vGBEqzTmouAECnVceyQqyqdsSiqLQISBL29aUW4U/M7pSPA/gEUZQqv1cwx4OnYxTxve5UMg5GT6L4JJg==" crossorigin=anonymous><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin=anonymous><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/styles/atom-one-dark.min.css crossorigin=anonymous title=hl-light><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/styles/atom-one-dark.min.css crossorigin=anonymous title=hl-dark disabled><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.5.1/leaflet.css integrity="sha256-SHMGCYmST46SoyGgo4YR/9AlK1vf3ff84Aq9yK4hdqM=" crossorigin=anonymous><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Lato:400,700%7CMerriweather%7CRoboto+Mono%7CRoboto&display=swap"><link rel=stylesheet href=/css/academic.css><link rel=manifest href=/index.webmanifest><link rel=icon type=image/png sizes=32x32 href=/img/icon-32.png><link rel=apple-touch-icon type=image/png href=/img/icon-192.png><link rel=canonical href=https://louis.faure.dev/post/nb/><meta property="twitter:card" content="summary"><meta property="og:site_name" content="Louis Faure"><meta property="og:url" content="https://louis.faure.dev/post/nb/"><meta property="og:title" content="Negative Binomial Modeling for scRNA-seq | Louis Faure"><meta property="og:description" content="The negative binomial (NB) distribution is the canonical statistical model for single-cell RNA-seq (scRNA-seq) gene expression integer counts. It’s favored over the Poisson distribution because real scRNA-seq data are overdispersed—their variance greatly exceeds their mean–due to both biological and technical factors (cell heterogeneity, bursty transcription, varied sequencing depth, dropouts, etc.).
The Poisson’s simple assumption (variance equals mean) fails in this context. In contrast, the NB augments the Poisson distribution with a dispersion parameter ($\theta$), so its variance is $\sigma^2 = \mu + \mu^2 / \theta$ (for mean $\mu$)."><meta property="og:image" content="https://louis.faure.dev/img/headers/newyork.jpg"><meta property="twitter:image" content="https://louis.faure.dev/img/headers/newyork.jpg"><meta property="og:locale" content="en-us"><meta property="article:published_time" content="2025-06-01T00:00:00+00:00"><meta property="article:modified_time" content="2025-06-01T00:00:00+00:00"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://louis.faure.dev/post/nb/"},"headline":"Negative Binomial Modeling for scRNA-seq","datePublished":"2025-06-01T00:00:00Z","dateModified":"2025-06-01T00:00:00Z","author":{"@type":"Person","name":"Louis Faure"},"publisher":{"@type":"Organization","name":"Louis Faure","logo":{"@type":"ImageObject","url":"https://louis.faure.dev/img/icon-512.png"}},"description":"The negative binomial (NB) distribution is the canonical statistical model for single-cell RNA-seq (scRNA-seq) gene expression integer counts. It’s favored over the Poisson distribution because real scRNA-seq data are overdispersed—their variance greatly exceeds their mean–due to both biological and technical factors (cell heterogeneity, bursty transcription, varied sequencing depth, dropouts, etc.).\nThe Poisson’s simple assumption (variance equals mean) fails in this context. In contrast, the NB augments the Poisson distribution with a dispersion parameter ($\\theta$), so its variance is $\\sigma^2 = \\mu + \\mu^2 / \\theta$ (for mean $\\mu$)."}</script><title>Negative Binomial Modeling for scRNA-seq | Louis Faure</title></head><script src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.4/imagesloaded.pkgd.min.js integrity="sha256-lqvxZrPLtfffUl2G/e7szqSvPBILGbwmsGE1MKlOi0Q=" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.6/isotope.pkgd.min.js integrity="sha256-CBrpuqrMhXwcLLUd5tvQ4euBHCdh7wGlDfNz8vbu/iI=" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js integrity="sha256-yt2kYMy0w8AbtF89WXb2P1rfjcP/HTHLT7097U8Y5b8=" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/highlight.min.js integrity="sha256-1zu+3BnLYV9LdiY85uXMzii3bdrkelyp37e0ZyTAQh0=" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/languages/r.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.5.1/leaflet.js integrity="sha256-EErZamuLefUnbMBQbsEqu1USa+btR2oIlCpBJbyD4/g=" crossorigin=anonymous></script><script>hljs.initHighlightingOnLoad()</script><script>const search_config={indexURI:"/index.json",minLength:1,threshold:.3},i18n={no_results:"No results found",placeholder:"Search...",results:"results found"},content_type={post:"Posts",project:"Projects",publication:"Publications",talk:"Talks"}</script><script id=search-hit-fuse-template type=text/x-template>
      <div class="search-hit" id="summary-{{key}}">
      <div class="search-hit-content">
        <div class="search-hit-name">
          <a href="{{relpermalink}}">{{title}}</a>
          <div class="article-metadata search-hit-type">{{type}}</div>
          <p class="search-hit-description">{{snippet}}</p>
        </div>
      </div>
      </div>
    </script><script src=https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.2.1/fuse.min.js integrity="sha256-VzgmKYmhsGNNN4Ph1kMW+BjoYJM2jV5i4IlFoeZA9XI=" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin=anonymous></script><script src=/js/academic.min.58e34bcd7ee6a776877fa43d4a655144.js></script><body id=top data-spy=scroll data-offset=70 data-target=#TableOfContents><script>function toggleDarkMode(e,t,n,s){$("body").hasClass("dark")?($("html").css({opacity:0,visibility:"visible"}).animate({opacity:1},500),$("body").removeClass("dark"),e&&(t.disabled=!1,n.disabled=!0),$(".js-dark-toggle i").removeClass("fa-sun").addClass("fa-moon"),localStorage.setItem("dark_mode","0"),$(".svg-icon.svg-baseline").each(function(){let e=$(this).attr("src");e=e.replace("-dark.svg",".svg"),$(this).attr("src",e)}),s&&location.reload()):($("body").css({opacity:0,visibility:"visible"}).animate({opacity:1},500),$("body").addClass("dark"),e&&(t.disabled=!0,n.disabled=!1),$(".js-dark-toggle i").removeClass("fa-moon").addClass("fa-sun"),localStorage.setItem("dark_mode","1"),$(".svg-icon.svg-baseline").each(function(){let e=$(this).attr("src");e=e.replace(".svg","-dark.svg"),$(this).attr("src",e)}),s&&location.reload())}const setTheme=()=>{const e=localStorage.getItem("dark_mode");e||localStorage.setItem("dark_mode","2");const{classList:t}=document.body;if(e==="2"||!e){const e=window.matchMedia("(prefers-color-scheme: dark)").matches;e?(t.add("dark"),updateSvgPaths(!0)):updateSvgPaths(!1)}else e==="1"?(t.add("dark"),requestAnimationFrame(()=>{setTimeout(()=>{updateSvgPaths(!0),console.log("Class added and styles updated.")},0)})):updateSvgPaths(!1)};function updateSvgPaths(e){$(".svg-icon.svg-baseline").each(function(){let t=$(this).attr("src");e?t=t.replace(".svg","-dark.svg"):t=t.replace("-dark.svg",".svg"),$(this).attr("src",t)})}setTheme()</script><style>.wallpaper{position:fixed;bottom:0;right:0;height:100vh;width:auto;object-fit:cover;z-index:-9999}</style><div class=wallpaper><img src=https://louis.faure.dev//img/headers/newyork.jpg style=width:100%;height:auto;min-height:100%;min-width:1024px></div><aside class=search-results id=search><div class=container><section class=search-header><div class="row no-gutters justify-content-between mb-3"><div class=col-6><h1>Search</h1></div><div class="col-6 col-search-close"><a class=js-search href=#><i class="fas fa-times-circle text-muted" aria-hidden=true></i></a></div></div><div id=search-box><input name=q id=search-query placeholder=Search... autocapitalize=off autocomplete=off autocorrect=off spellcheck=false type=search></div></section><section class=section-search-results><div id=search-hits></div></section></div></aside><nav class="navbar navbar-light fixed-top navbar-expand-lg py-0 compensate-for-scrollbar" id=navbar-main><div class=container><a class=navbar-brand href=/>Louis Faure</a>
<button type=button class=navbar-toggler data-toggle=collapse data-target=#navbar aria-controls=navbar aria-expanded=false aria-label="Toggle navigation">
<span><i class="fas fa-bars"></i></span></button><div class="collapse navbar-collapse" id=navbar><ul class="navbar-nav mr-auto"><li class=nav-item><a class=nav-link href=/#about><span>About</span></a></li><li class=nav-item><a class=nav-link href=/#skills><span>Skills</span></a></li><li class=nav-item><a class=nav-link href=/#talk><span>Talks/Poster</span></a></li><li class=nav-item><a class=nav-link href=/#featured><span>Publications</span></a></li><li class=nav-item><a class=nav-link href=/#experience><span>Experience</span></a></li><li class=nav-item><a class=nav-link href=/files/CV.pdf><span>CV</span></a></li><span class=separator></span><li class=nav-item><a class="nav-link active" href=/post/><span>Blog posts</span></a></li><li class=nav-item><a class=nav-link href=/books/><span>Books</span></a></li></ul><ul class="navbar-nav ml-auto"><li class=nav-item><a class="nav-link js-search" href=#><i class="fas fa-search" aria-hidden=true></i></a></li><li class=nav-item><a class="nav-link js-dark-toggle" href=#><i class="fas fa-moon" aria-hidden=true></i></a></li></ul></div></div></nav><div class=article-cont><article class=article><div class=article-container><h1>Negative Binomial Modeling for scRNA-seq</h1><div class=article-metadata><span class=article-date>Jun 1, 2025
</span><span class=middot-divider></span>
<span class=article-reading-time>4 min read</span></div></div><div class=article-container><div class=article-style><p>The <strong>negative binomial (NB) distribution</strong> is the canonical statistical model for single-cell RNA-seq (<strong>scRNA-seq</strong>) gene expression integer counts. It’s favored over the Poisson distribution because <strong>real scRNA-seq data are overdispersed</strong>—their variance greatly exceeds their mean–due to both biological and technical factors (cell heterogeneity, bursty transcription, varied sequencing depth, dropouts, etc.).</p><p>The Poisson’s simple assumption (<strong>variance equals mean</strong>) fails in this context. In contrast, the NB augments the Poisson distribution with a <strong>dispersion parameter</strong> ($\theta$), so its variance is $\sigma^2 = \mu + \mu^2 / \theta$ (for mean $\mu$). This flexibility means two genes with equal mean expression but different variances (as commonly seen) can be modeled, simply by adjusting $\theta$.</p><p>From a generative perspective, the NB arises as a <strong>Poisson–Gamma mixture</strong>: each cell/gene’s unknown expression rate $\lambda$ is drawn from a Gamma distribution before Poisson sampling.</p><p><strong>Interpretability</strong> is another reason for NB’s use. Its parameters have clear biological meaning:</p><ul><li>$\mu$: expected transcript count</li><li>$\theta$: gene/cell-specific overdispersion</li></ul><hr><h3 id=parameterizations-standard-and-logit-used-in-deep-learning><strong>Parameterizations: Standard and Logit (Used in Deep Learning)</strong></h3><p><strong>Standard NB:</strong><br>Usually parameterized with shape ($\theta$, often called <code>total_count</code>) and success probability ($p$):</p>$$\mu = \frac{\theta (1-p)}{p} \quad \text{and} \quad \sigma^2 = \mu + \frac{\mu^2}{\theta}$$<p><strong>Logit Parameterization:</strong><br>For deep learning, the NB can be more robustly parameterized via <strong>logits</strong> instead of $p$:</p>$$\text{logits} = \log\left(\frac{p}{1-p}\right), \quad \mu = \theta \cdot e^{-\text{logits}}$$<p>Using logits stabilizes optimization, especially for auto-differentiation and large likelihoods.</p><hr><h3 id=numpyros-negative-binomial-logits-implementation><strong>NumPyro&rsquo;s Negative Binomial Logits Implementation</strong></h3><p>Below is the core class definition for <code>NegativeBinomialLogits</code> within NumPyro, showcasing how this parameterization is handled internally.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>NegativeBinomialLogits</span>(GammaPoisson):
</span></span><span style=display:flex><span>    arg_constraints <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;total_count&#34;</span>: constraints<span style=color:#f92672>.</span>positive,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;logits&#34;</span>: constraints<span style=color:#f92672>.</span>real,
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    support <span style=color:#f92672>=</span> constraints<span style=color:#f92672>.</span>nonnegative_integer
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> __init__(self, total_count, logits, _, validate_args<span style=color:#f92672>=</span><span style=color:#66d9ef>None</span>):
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>total_count, self<span style=color:#f92672>.</span>logits <span style=color:#f92672>=</span> promote_shapes(total_count, logits)
</span></span><span style=display:flex><span>        concentration <span style=color:#f92672>=</span> total_count
</span></span><span style=display:flex><span>        rate <span style=color:#f92672>=</span> jnp<span style=color:#f92672>.</span>exp(<span style=color:#f92672>-</span>logits)
</span></span><span style=display:flex><span>        super()<span style=color:#f92672>.</span>__init__(concentration, rate, validate_args<span style=color:#f92672>=</span>validate_args)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@validate_sample</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>log_prob</span>(self, value):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#f92672>-</span>(
</span></span><span style=display:flex><span>            self<span style=color:#f92672>.</span>total_count <span style=color:#f92672>*</span> nn<span style=color:#f92672>.</span>softplus(self<span style=color:#f92672>.</span>logits)
</span></span><span style=display:flex><span>            <span style=color:#f92672>+</span> value <span style=color:#f92672>*</span> nn<span style=color:#f92672>.</span>softplus(<span style=color:#f92672>-</span>self<span style=color:#f92672>.</span>logits)
</span></span><span style=display:flex><span>            <span style=color:#f92672>+</span> _log_beta_1(self<span style=color:#f92672>.</span>total_count, value)
</span></span><span style=display:flex><span>        )
</span></span></code></pre></div><p>This <code>NegativeBinomialLogits</code> class directly implements the logit parameterization, inheriting from <code>GammaPoisson</code> which underlines the Poisson-Gamma mixture interpretation.</p><ul><li><strong><code>__init__</code></strong>: The constructor takes <code>total_count</code> (our $\theta$) and <code>logits</code> as input. Crucially, it transforms these into <code>concentration</code> and <code>rate</code> parameters for the underlying Gamma distribution (<code>jnp.exp(-logits)</code> is used to derive the rate from logits). This reflects the Poisson-Gamma mixture where the mean of the Poisson is drawn from a Gamma distribution defined by these concentration/rate parameters.</li><li><strong><code>log_prob</code></strong>: This is the main method that will participate in the loss trained by our VAE (alongside the KL term). It calculates the log-probability of observing a <code>value</code> (i.e., a specific count) given the <code>total_count</code> and <code>logits</code>. The formula used is a numerically stable computation of the negative binomial log-likelihood, leveraging <code>nn.softplus</code> for <code>log(1+exp(x))</code> terms and <code>_log_beta_1</code> for the beta function-related terms, ensuring robustness particularly for deep learning optimization.</li></ul><hr><h3 id=practical-implementation-in-vaes-eg-scvi><strong>Practical Implementation in VAEs (e.g., scVI)</strong></h3><p>Typical scVI-like models predict expected gene counts using neural networks and model observed counts as NB.
Two common implementations differ mainly in how they handle normalization and numerical stability:</p><h4 id=1-standard-softmax-version-used-by-scvi><strong>1. Standard (Softmax) Version used by scVI</strong></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>rate <span style=color:#f92672>=</span> x_decoder(z)                       <span style=color:#75715e># Unconstrained decoder output</span>
</span></span><span style=display:flex><span>rate_softmax <span style=color:#f92672>=</span> jax<span style=color:#f92672>.</span>nn<span style=color:#f92672>.</span>softmax(rate)       <span style=color:#75715e># Gene proportions (sum to 1)</span>
</span></span><span style=display:flex><span>mu <span style=color:#f92672>=</span> jnp<span style=color:#f92672>.</span>log(l <span style=color:#f92672>*</span> rate_softmax <span style=color:#f92672>+</span> epsilon)  <span style=color:#75715e># Expected log-counts (scaled by library size l)</span>
</span></span><span style=display:flex><span>nb_logits <span style=color:#f92672>=</span> mu <span style=color:#f92672>-</span> jnp<span style=color:#f92672>.</span>log(theta <span style=color:#f92672>+</span> epsilon)
</span></span><span style=display:flex><span>x_dist <span style=color:#f92672>=</span> dist<span style=color:#f92672>.</span>NegativeBinomialLogits(total_count<span style=color:#f92672>=</span>theta <span style=color:#f92672>+</span> epsilon, logits<span style=color:#f92672>=</span>nb_logits)
</span></span></code></pre></div><table><thead><tr><th>Variable</th><th>Description / Formula / Interpretation</th></tr></thead><tbody><tr><td><code>z</code></td><td>Latent representation from the VAE encoder.</td></tr><tr><td><code>x_decoder(z)</code></td><td>Neural network output (logits for each gene, unnormalized).</td></tr><tr><td><code>rate</code></td><td>Unnormalized decoder output (log-space) → interpretable as <strong>relative log-expression</strong>.</td></tr><tr><td><code>rate_softmax</code></td><td>Softmax over genes → interpretable as <strong>cell-specific gene proportions</strong>.</td></tr><tr><td><code>l</code></td><td>Library size (total counts per cell, either learned or fixed).</td></tr><tr><td><code>mu</code></td><td>Log of the <strong>expected counts</strong> for each gene: $\mu = \log(l \cdot \text{softmax(rate)})$ (This ensures $\sum \exp(\mu) \approx l$, matching the library size.)</td></tr><tr><td><code>theta</code></td><td>Dispersion parameter (gene-specific).</td></tr><tr><td><code>nb_logits</code></td><td>Computed as $\log(\mu / \theta)$, the log-odds for the NB.</td></tr><tr><td><code>epsilon</code></td><td>Small constant for numerical stability.</td></tr></tbody></table><h4 id=2-stable-log-space-version><strong>2. Stable (Log-Space) Version</strong></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>rate <span style=color:#f92672>=</span> x_decoder(z)
</span></span><span style=display:flex><span>mu <span style=color:#f92672>=</span> jnp<span style=color:#f92672>.</span>log(l) <span style=color:#f92672>+</span> rate <span style=color:#f92672>-</span> jax<span style=color:#f92672>.</span>scipy<span style=color:#f92672>.</span>special<span style=color:#f92672>.</span>logsumexp(rate, axis<span style=color:#f92672>=-</span><span style=color:#ae81ff>1</span>, keepdims<span style=color:#f92672>=</span><span style=color:#66d9ef>True</span>)
</span></span><span style=display:flex><span>nb_logits <span style=color:#f92672>=</span> mu <span style=color:#f92672>-</span> logtheta
</span></span><span style=display:flex><span>x_dist <span style=color:#f92672>=</span> dist<span style=color:#f92672>.</span>NegativeBinomialLogits(total_count<span style=color:#f92672>=</span>jnp<span style=color:#f92672>.</span>exp(logtheta), logits<span style=color:#f92672>=</span>nb_logits)
</span></span></code></pre></div><p>With the following changes:</p><table><thead><tr><th>Variable</th><th>Description / Formula / Interpretation</th></tr></thead><tbody><tr><td><code>logsumexp(rate)</code></td><td>Log of the sum of exponentials (numerically stable softmax denominator).</td></tr><tr><td><code>mu</code></td><td>Log expected counts, computed as: $\mu = \log(l) + \text{rate} - \text{logsumexp(rate)}$. This is equivalent to the first implementation: $\mu = \log(l \cdot \text{softmax(rate)})$, but avoids explicit softmax.</td></tr><tr><td><code>l</code></td><td>Library size (total counts per cell, either learned or fixed).</td></tr><tr><td><code>logtheta</code></td><td>Directly learned log of the dispersion parameter (more numerically stable).</td></tr><tr><td><code>nb_logits</code></td><td>Computed as $\log(\mu / \theta)$, where <code>theta = exp(logtheta)</code>.</td></tr></tbody></table><p>In that implementation, no need for <code>epsilon</code>!</p><p><strong>Both approaches are mathematically equivalent.</strong> The second, log-space variant is regularly preferred in practice, especially as it avoids over/underflow errors in large or sparse data.</p><table><thead><tr><th><strong>Aspect</strong></th><th><strong>Softmax Version</strong></th><th><strong>Log-Space Version</strong></th></tr></thead><tbody><tr><td>Normalization</td><td>Explicit softmax</td><td>Logsumexp in log-space</td></tr><tr><td>Stability</td><td>Good, but softmax over/underflow</td><td>Excellent, all log-domain</td></tr><tr><td>Dispersion Handling</td><td>Direct $\theta$</td><td>Log-dispersion (<code>logtheta</code>)</td></tr></tbody></table><hr><p><strong>Summary</strong>:</p><ul><li>The negative binomial&rsquo;s extra dispersion is essential for scRNA-seq modeling.</li><li>Deep learning models (e.g., scVI) implement NB via softmax, but here we propose logits parametrization for numerical stability and flexibility, employing log-space calculations for best results.</li></ul></div><div class=share-box aria-hidden=true><ul class=share><li><a href="https://twitter.com/intent/tweet?url=https://louis.faure.dev/post/nb/&amp;text=Negative%20Binomial%20Modeling%20for%20scRNA-seq" target=_blank rel=noopener class=share-btn-twitter><i class="fab fa-twitter"></i></a></li><li><a href="https://www.facebook.com/sharer.php?u=https://louis.faure.dev/post/nb/&amp;t=Negative%20Binomial%20Modeling%20for%20scRNA-seq" target=_blank rel=noopener class=share-btn-facebook><i class="fab fa-facebook"></i></a></li><li><a href="mailto:?subject=Negative%20Binomial%20Modeling%20for%20scRNA-seq&amp;body=https://louis.faure.dev/post/nb/" target=_blank rel=noopener class=share-btn-email><i class="fas fa-envelope"></i></a></li><li><a href="https://www.linkedin.com/shareArticle?url=https://louis.faure.dev/post/nb/&amp;title=Negative%20Binomial%20Modeling%20for%20scRNA-seq" target=_blank rel=noopener class=share-btn-linkedin><i class="fab fa-linkedin-in"></i></a></li><li><a href="https://web.whatsapp.com/send?text=Negative%20Binomial%20Modeling%20for%20scRNA-seq%20https://louis.faure.dev/post/nb/" target=_blank rel=noopener class=share-btn-whatsapp><i class="fab fa-whatsapp"></i></a></li><li><a href="https://service.weibo.com/share/share.php?url=https://louis.faure.dev/post/nb/&amp;title=Negative%20Binomial%20Modeling%20for%20scRNA-seq" target=_blank rel=noopener class=share-btn-weibo><i class="fab fa-weibo"></i></a></li></ul></div><div class="media author-card content-widget-hr"><img class="portrait mr-3" src=/authors/authors/avatar_hu8cb5cec5c4abae32b2a3dbc9f09ba7f8_323173_250x250_fill_q90_lanczos_center.jpg alt=Avatar><div class=media-body><h5 class=card-title><a href=https://louis.faure.dev/>Louis Faure</a></h5><h6 class=card-subtitle>Postdoctoral Research Scholar</h6><ul class=network-icon aria-hidden=true><li><a href=mailto:faurel1@mskcc.org><i class="fas fa-envelope"></i></a></li><li><a href=https://mobile.twitter.com/LouisFaure_ target=_blank rel=noopener><i class="fab fa-twitter"></i></a></li><li><a href=https://bsky.app/profile/faure.dev target=_blank rel=noopener><i class="fab fa-bluesky"></i></a></li><li><a href=https://orcid.org/0000-0003-4621-586X target=_blank rel=noopener><i class="fab fa-orcid"></i></a></li><li><a href="https://scholar.google.com/citations?user=Tc8i56oAAAAJ" target=_blank rel=noopener><i class="ai ai-google-scholar"></i></a></li><li><a href=https://github.com/louisfaure target=_blank rel=noopener><i class="fab fa-github"></i></a></li><li><a href=https://soundcloud.com/louisfaure target=_blank rel=noopener><i class="fab fa-soundcloud"></i></a></li></ul></div></div></div></article></div><div class=container><footer class=site-footer><p class=powered-by>Heavily customized
<a href=https://sourcethemes.com/academic/ target=_blank rel=noopener>Academic theme</a> for
<a href=https://gohugo.io target=_blank rel=noopener>Hugo</a>.
<span class=float-right aria-hidden=true><a href=# class=back-to-top><span class=button_icon><i class="fas fa-chevron-up fa-2x"></i></span></a></span></p></footer></div><div id=modal class="modal fade" role=dialog><div class=modal-dialog><div class=modal-content><div class=modal-header><h5 class=modal-title>Cite</h5><button type=button class=close data-dismiss=modal aria-label=Close>
<span aria-hidden=true>&#215;</span></button></div><div class=modal-body><pre><code class="tex hljs"></code></pre></div><div class=modal-footer><a class="btn btn-outline-primary my-1 js-copy-cite" href=# target=_blank><i class="fas fa-copy"></i> Copy
</a><a class="btn btn-outline-primary my-1 js-download-cite" href=# target=_blank><i class="fas fa-download"></i> Download</a><div id=modal-error></div></div></div></div></div></body></html>